<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Git Workflow Mastery (Main ⇄ Develop)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    :root{
      --text:#1a202c;--heading:#1a365d;--muted:#4a5568;--bg:#f7fafc;--surface:#fff;--border:#e2e8f0;
      --code:#0f172a;--code-text:#e2e8f0;--inline:#edf2f7;
      --ok:#38a169;--warn:#dd6b20;--bad:#e53e3e;
      --primary:#4f46e5;--primary-light:#e0e7ff;
      --shadow-sm:0 1px 3px rgba(0,0,0,.1);--shadow-md:0 4px 6px rgba(0,0,0,.07);--shadow-lg:0 10px 25px rgba(0,0,0,.08);
      --r:12px;--r-lg:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica Neue,Arial,Noto Sans;
      line-height:1.6;background:linear-gradient(135deg,#f5f7fa 0%,#e4edf5 100%);color:var(--text);min-height:100vh}
    h1,h2,h3{color:var(--heading);margin-top:0;font-weight:700}
    h1{ text-align:center;margin-bottom:.5rem;font-size:2.4rem;
      background:linear-gradient(90deg,var(--primary),var(--ok));-webkit-background-clip:text;background-clip:text;color:transparent;display:inline-block;position:relative}
    h1::after{content:"";position:absolute;bottom:-8px;left:50%;transform:translateX(-50%);width:80px;height:4px;background:linear-gradient(90deg,var(--primary),var(--ok));border-radius:2px}
    h2{font-size:1.3rem;display:flex;gap:10px;align-items:center}
    ul{padding-left:22px;margin:.5rem 0} li{margin:.5rem 0} li::marker{color:var(--primary)}
    .container{max-width:1100px;margin:2rem auto;padding:2.2rem;background:var(--surface);border-radius:var(--r-lg);box-shadow:var(--shadow-lg);position:relative;overflow:hidden}
    .container::before{content:"";position:absolute;top:0;left:0;right:0;height:5px;background:linear-gradient(90deg,var(--primary),var(--ok))}
    .subtitle{text-align:center;color:var(--muted);margin:0 auto 2rem;font-size:1.05rem;font-weight:500;max-width:720px}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:1.25rem 1.5rem;margin:1.1rem 0;border-left:6px solid transparent;box-shadow:var(--shadow-sm);transition:.2s}
    .card:hover{transform:translateY(-2px);box-shadow:var(--shadow-md)}
    .card-ok{border-left-color:var(--ok);background:rgba(56,161,105,.03)}
    .card-warn{border-left-color:var(--warn);background:rgba(221,107,32,.03)}
    .card-bad{border-left-color:var(--bad);background:rgba(229,62,62,.03)}
    pre{background:var(--code);color:var(--code-text);padding:1rem 1.1rem;border-radius:var(--r);overflow-x:auto;font-size:.9em;position:relative;border:1px solid rgba(255,255,255,.08);margin:1rem 0}
    code{background:var(--inline);color:var(--code);padding:2px 6px;border-radius:6px;font-size:.9em;font-weight:500;border:1px solid rgba(0,0,0,.05)}
    pre>code{background:transparent;color:inherit;padding:0;border:none}
    header{text-align:center;margin-bottom:2rem;padding-bottom:2rem;border-bottom:1px solid var(--border)}
    .icon{display:inline-flex;align-items:center;justify-content:center;width:32px;height:32px;background:var(--primary-light);border-radius:50%;margin-right:8px}
    @media (max-width:768px){.container{padding:1.25rem;margin:1rem}h1{font-size:2rem}.card{padding:1rem}pre{padding:.8rem}}
    .kbd{display:inline-block;padding:.15rem .35rem;border:1px solid #999;border-bottom-width:2px;border-radius:6px;background:#fff;font-family:ui-monospace,Consolas,monospace;font-size:.85em}
  </style>
</head>
<body>
  <main class="container">
    <header>
      <h1>Git Workflow Mastery</h1>
      <p class="subtitle">Main ⇄ Develop with Features, Releases, Hotfixes • Protections Respected • Sync main → develop after releases</p>
    </header>

    <section class="card card-ok">
      <h2><span class="icon"><i class="fas fa-play"></i></span>Start Here (every time)</h2>
      <p>Begin from a clean <code>develop</code> so branches behave predictably.</p>
      <pre><code>git fetch origin --prune                # update remote refs; remove deleted ones
git switch develop                      # move to develop
git pull --rebase                       # update while keeping a straight history</code></pre>
      <p><strong>Quick flags:</strong> <code>--rebase</code> = replay your local commits after remote; <code>--prune</code> = tidy remote refs.</p>
    </section>

    <section class="card">
      <h2><span class="icon"><i class="fas fa-scale-balanced"></i></span>Parity & Quick Proofs</h2>
      <p>Use <strong>content</strong> parity, not commit counts (squash creates new SHAs).</p>
      <pre><code>git fetch origin --prune
git rev-parse origin/main^{tree}; git rev-parse origin/develop^{tree}
# If the two tree hashes are identical, content is identical (✅).

# A quick diff if they differ:
git diff --name-status origin/main origin/develop</code></pre>
    </section>

    <section class="card">
      <h2><span class="icon"><i class="fas fa-bolt"></i></span>Cheatsheet</h2>
      <ul>
        <li><code>--ff-only</code> = fast‑forward only (abort if merge commit would be created).</li>
        <li><code>--no-ff</code> = force a merge commit (avoid on protected branches).</li>
        <li><code>-u</code> / <code>--set-upstream</code> = remember remote branch.</li>
        <li><code>gh pr create --base X --head Y</code> = PR from Y into X.</li>
        <li><code>gh pr merge --squash --auto</code> = squash merge when green + approved.</li>
      </ul>
    </section>

    <section class="card">
      <h2><span class="icon"><i class="fas fa-list-check"></i></span>Quick Decision Guide</h2>
      <ul>
        <li><strong>New work (Features):</strong> <code>feature/*</code> off <code>develop</code> → PR to <code>develop</code> → <strong>squash</strong>.</li>
        <li><strong>Ship to Production (Release):</strong> <code>release/*</code> off <code>develop</code> → PR to <code>main</code> → <strong>squash</strong> → <strong>sync main → develop</strong>.</li>
        <li><strong>Emergency Fix:</strong> <code>hotfix/*</code> off <code>main</code> → PR to <code>main</code> → <strong>squash</strong> → <strong>back‑merge main → develop</strong>.</li>
      </ul>
    </section>

    <section class="card">
      <h2><span class="icon"><i class="fas fa-code-branch"></i></span>Feature Flow</h2>
      <pre><code># 1) Start clean on develop
git fetch origin --prune
git switch develop
git pull --rebase

# 2) Create feature branch
git switch -c feature/my-change

# 3) Work, commit, push
git add .
git commit -m "feat: my change"
git push -u origin HEAD

# 4) PR: feature → develop
gh pr create --base develop --head feature/my-change --title "feat: my change" --body "…"
gh pr merge --squash --auto

# 5) Clean up + resync
git switch develop && git pull --rebase
git branch -d feature/my-change</code></pre>
    </section>

    <section class="card">
      <h2><span class="icon"><i class="fas fa-rocket"></i></span>Release Flow (squash-friendly)</h2>
      <pre><code># 1) Cut release from latest develop
git switch develop && git pull --rebase
git switch -c release/v0.4.0
git push -u origin HEAD

# 2) PR: release → main (squash merge)
gh pr create --base main --head release/v0.4.0 --title "Release v0.4.0" --body "…"
gh pr merge --squash --auto

# 3) Sync main → develop (squash makes FF impossible)
git fetch origin --prune
git switch -c sync/m2d origin/main
git push -u origin HEAD
gh pr create --base develop --head sync/m2d --title "Sync: main → develop" --body "Bring production commit back."
gh pr merge --squash --auto

# 4) Verify content parity (0 0 not required with squashes)
git fetch origin --prune
git rev-parse origin/main^{tree}; git rev-parse origin/develop^{tree}
git diff --name-status origin/main origin/develop || true

# 5) Tidy
git switch develop && git pull --rebase
git push origin :sync/m2d
git push origin :release/v0.4.0</code></pre>
    </section>

    <section class="card">
      <h2><span class="icon"><i class="fas fa-hand-scissors"></i></span>Release Option A — Cherry‑pick from Production</h2>
      <p>Use when <code>develop</code> has mixed readiness. Start from <code>main</code> and cherry‑pick only the commits you want.</p>
      <pre><code># From a clean repo
git fetch origin --prune
git switch -c release/v0.4.0 origin/main                 # start release from production

# See what's new on develop compared to main (choose from this list)
git log --oneline --no-merges origin/main..origin/develop

# Cherry-pick only the commits you want to ship (one by one; resolve conflicts if any)
git cherry-pick &lt;sha1&gt; &lt;sha2&gt;                            # these are the squashed PR commits

git push -u origin HEAD                                  # publish release branch

# PR to main and squash-merge (deploy)
gh pr create --base main --head release/v0.4.0 --title "Release v0.4.0" --body "Cherry-picked: &lt;list&gt;"
gh pr merge --squash --auto

# Sync main → develop (tiny PR because of squash)
git fetch origin --prune
git switch -c sync/m2d origin/main
git push -u origin HEAD
gh pr create --base develop --head sync/m2d --title "Sync: main → develop" --body "Bring production commit into develop."
gh pr merge --squash --auto</code></pre>
    </section>

    <section class="card">
      <h2><span class="icon"><i class="fas fa-scissors"></i></span>Release Option B — Stabilize off Develop</h2>
      <pre><code>git fetch origin --prune
git switch develop && git pull --rebase
git switch -c release/v0.4.0

# Revert unready changes (use squashed PR SHAs)
git revert &lt;shaA&gt; &lt;shaB&gt;  # or: git revert --no-commit ... &amp;&amp; git commit -m "chore: drop unready"
git push -u origin HEAD

# PR to main → squash → sync main → develop</code></pre>
    </section>

    <section class="card">
      <h2><span class="icon"><i class="fas fa-fire"></i></span>Hotfix Flow</h2>
      <pre><code># 1) Branch from production
git fetch origin --prune && git switch main && git pull --rebase
git switch -c hotfix/fix-urgent-issue
git push -u origin HEAD

# 2) PR: hotfix → main (squash)
gh pr create --base main --head hotfix/fix-urgent-issue --title "hotfix: fix urgent issue" --body "…"
gh pr merge --squash --auto

# 3) Back-merge main → develop via sync PR
git fetch origin --prune
git switch -c sync/hotfix origin/main
git push -u origin HEAD
gh pr create --base develop --head sync/hotfix --title "Back-merge hotfix main → develop" --body "…"
gh pr merge --squash --auto</code></pre>
    </section>

    <section class="card">
      <h2><span class="icon"><i class="fas fa-hammer"></i></span>Resolve Conflicts Fast</h2>
      <pre><code># Keep your current branch's version (ours)
git checkout --ours path/to/file && git add path/to/file

# Keep the incoming branch's version (theirs)
git checkout --theirs path/to/file && git add path/to/file

# Finish
git commit                 # if merging
git rebase --continue      # if rebasing

# Abort
git merge --abort          # or: git rebase --abort

# Stash if working tree blocks a pull/rebase
git stash -u -m wip && git pull --rebase && git stash pop</code></pre>
    </section>

    <section class="card card-warn">
      <h2><span class="icon"><i class="fas fa-exclamation-triangle"></i></span>Quick Fix — FF not possible</h2>
      <p>After a squash release, <code>git merge --ff-only origin/main</code> to <code>develop</code> will fail. Use a sync PR:</p>
      <pre><code>git fetch origin --prune
git switch -c sync/m2d origin/main
git push -u origin HEAD
gh pr create --base develop --head sync/m2d --title "Sync: main → develop" --body "Bring production commit into develop."
gh pr merge --squash --auto
git switch develop && git pull --rebase</code></pre>
    </section>

    <section class="card">
      <h2><span class="icon"><i class="fas fa-gear"></i></span>CI & Rules You Rely On</h2>
      <pre><code># .github/workflows/05-pr-quality-gate.yml (triggers that avoid "Expected")
on:
  pull_request:
    branches: ["**"]                        # run for PRs to any base branch
    types: [opened, synchronize, reopened]  # rerun on every PR update
  merge_group: {}                           # report status for merge queue/auto-merge</code></pre>

      <pre><code># Terraform (squash-only merge methods)
resource "github_repository" "repo" {
  name                   = var.repo_name
  allow_merge_commit     = false
  allow_rebase_merge     = false
  allow_squash_merge     = true
  delete_branch_on_merge = true
}</code></pre>

      <pre><code># Admin workflow must import repo before apply (avoids 422 create)
terraform import github_repository.repo "${{ github.event.repository.name }}"</code></pre>

      <pre><code># S3 backend init (no deprecation warning)
-backend-config="use_lockfile=true"</code></pre>
    </section>

    <section class="card">
      <h2><span class="icon"><i class="fas fa-broom"></i></span>Clean Branches</h2>
      <pre><code># Remove merged remote branches (except main/develop)
for b in $(git ls-remote --heads origin | awk '{print $2}' | sed 's@refs/heads/@@' | grep -vE '^(main|develop)$'); do
  git push origin :"$b" || true
done

# Remove local branches (except main/develop)
for lb in $(git for-each-ref --format='%(refname:short)' refs/heads | grep -vE '^(main|develop)$'); do
  git branch -D "$lb" || true
done</code></pre>
    </section>
  </main>
</body>
</html>
