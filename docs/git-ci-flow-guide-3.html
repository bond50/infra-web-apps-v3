<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Git Workflow Mastery Guide</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                margin: 0;
                padding: 0;
                background-color: #f4f7f6;
                color: #333;
            }
            .container {
                max-width: 1000px;
                margin: 30px auto;
                padding: 20px;
                background-color: #fff;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                border-radius: 8px;
            }
            h1,
            h2,
            h3 {
                color: #007acc;
                border-bottom: 2px solid #eee;
                padding-bottom: 5px;
            }
            h1 {
                text-align: center;
                margin-bottom: 20px;
                color: #2c3e50;
            }
            h2 {
                margin-top: 30px;
                border-color: #007acc;
            }
            h3 {
                color: #555;
                margin-top: 20px;
                border-bottom: none;
            }
            .workflow {
                margin-bottom: 40px;
                padding: 15px;
                border-left: 5px solid #007acc;
                background-color: #f9f9f9;
                border-radius: 4px;
            }
            .workflow.hotfix {
                border-left-color: #e74c3c;
            }
            .workflow.core {
                border-left-color: #1abc9c;
            }
            code {
                background-color: #eee;
                padding: 2px 4px;
                border-radius: 3px;
                font-family: 'Consolas', 'Courier New', monospace;
                font-size: 0.9em;
                color: #d35400;
            }
            pre {
                background-color: #2c3e50;
                color: #ecf0f1;
                padding: 10px;
                border-radius: 4px;
                overflow-x: auto;
                margin-top: 10px;
            }
            pre code {
                background-color: transparent;
                color: inherit;
                padding: 0;
            }
            ul {
                margin-top: 5px;
                padding-left: 20px;
            }
            li {
                margin-bottom: 8px;
            }
            .tip {
                background-color: #ecf0f1;
                border-left: 5px solid #3498db;
                padding: 10px;
                margin-top: 15px;
                border-radius: 4px;
            }
            .quick-guide {
                margin-top: 30px;
                padding: 15px;
                background-color: #e8f8f5;
                border: 1px solid #1abc9c;
                border-radius: 4px;
            }
            .quick-guide h2 {
                color: #1abc9c;
                border-color: #1abc9c;
            }
            .explanation-box {
                margin-top: 10px;
                padding: 10px;
                border: 1px solid #ccc;
                border-radius: 4px;
                background-color: #f0f0f0;
            }
            .explanation-box p {
                margin-top: 5px;
            }
            .explanation-box strong {
                color: #007acc;
            }
            .merge-note {
                color: #e74c3c;
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>Git Workflow Mastery Guide (Git Flow + CI/Terraform)</h1>

            <div class="quick-guide">
                <h2>Quick Decision Guide</h2>
                <ul>
                    <li>
                        <strong>New work (Features)</strong>:
                        <code>feature/*</code> off <code>develop</code> &rarr;
                        PR to <code>develop</code>.
                    </li>
                    <li>
                        <strong>Shipping to Production</strong>:
                        <code>release/*</code> off <code>develop</code> &rarr;
                        PR to <code>main</code> &rarr; merge &rarr;
                        <strong>APPLY</strong>.
                    </li>
                    <li>
                        <strong>Emergency Fix</strong>:
                        <code>hotfix/*</code> off <code>main</code> &rarr; PR to
                        <code>main</code> &rarr; merge &rarr;
                        <strong>APPLY</strong> &rarr; Back-merge to
                        <code>develop</code>.
                    </li>
                </ul>
            </div>

            <div class="workflow core">
                <h2>A. Core Git Sync Commands (Always Start Here)</h2>
                <p>
                    <strong>Goal:</strong> Ensure your local branch is perfectly
                    synchronized with the remote, maintaining a **linear commit
                    history**.
                </p>
                <pre><code># 1. Update remote tracking branches (safe to run anywhere)
git fetch origin

# 2. Get to your target branch (e.g., develop)
git switch develop

# 3. Pull updates, replaying your local commits on top of remote
git pull --rebase </code></pre>
                <div class="explanation-box">
                    <p>
                        <strong>Why <code>--rebase</code>?</strong> It takes
                        your local commits, gets the remote changes, and
                        reapplies your commits **on top** of the remote changes.
                        This avoids unnecessary merge commits and keeps your
                        history clean and straight.
                    </p>
                </div>
            </div>

            <div class="workflow">
                <h2>1. Everyday Work (Features)</h2>
                <p>
                    <strong>Goal:</strong> Add new features/non-urgent changes.
                    **Path:** <code>develop</code> &rarr;
                    <code>feature/*</code> &rarr; PR &rarr; <code>develop</code>
                </p>

                <h3>Step 1: Start Clean on <code>develop</code></h3>
                <pre><code># Sync develop and ensure linear history
git switch develop
git pull --rebase </code></pre>

                <h3>
                    Step 2: Create a Feature Branch Off <code>develop</code>
                </h3>
                <p class="tip">
                    Use short, descriptive names (e.g.,
                    <code>feature/sg-rules</code>,
                    <code>feature/ecr-cleanup</code>).
                </p>
                <pre><code>git switch -c feature/my-change </code></pre>

                <h3>Step 3: Edit, Stage, and Commit</h3>
                <pre><code>git add &lt;files...&gt;
git commit -m "feat: short description of the change"

# Quick Fix: If local hook blocks you (e.g., missing pre-commit), bypass ONCE:
# git commit -m "feat: ..." --no-verify </code></pre>

                <h3>Step 4: Push the Feature Branch & Open PR</h3>
                <pre><code># The first push must set the upstream remote
git push -u origin feature/my-change </code></pre>
                <ul>
                    <li>
                        <strong>Open PR:</strong> Base: <code>develop</code> |
                        Compare: <code>feature/my-change</code>
                    </li>
                    <li>
                        **CI Action:** Runs "05 - PR Quality Gate" (fmt,
                        validate, tflint, checkov, safe plan).
                    </li>
                    <li>
                        **If CI Fails:** Fix locally, commit, and **simply**
                        <code>git push</code>. CI re-runs automatically.
                    </li>
                </ul>

                <h3>Step 5: Merge to <code>develop</code> & Sync Local</h3>
                <ul>
                    <li>
                        When PR is green (and approvals met), click **Squash and
                        merge** on the web UI.
                    </li>
                    <li>
                        <strong>Result:</strong> Your change is integrated into
                        <code>develop</code>. It is **NOT** yet in production.
                    </li>
                </ul>
                <pre><code># Sync your local develop for the next feature
git switch develop
git pull --rebase
# (Optional) Clean up local branch
git branch -d feature/my-change </code></pre>
            </div>

            <div class="workflow">
                <h2>2. Shipping to Production (Release)</h2>
                <p>
                    <strong>Goal:</strong> Move a set of stable changes from
                    <code>develop</code> to <code>main</code>/Production.
                    **Path:** <code>release/*</code> &rarr; PR &rarr;
                    <code>main</code> &rarr; Apply
                </p>

                <h3>Step 1: Cut a Release Branch from <code>develop</code></h3>
                <pre><code>git switch develop
git pull --rebase             # Ensure develop is 100% up to date
git switch -c release/v0.1.0
git push -u origin release/v0.1.0 </code></pre>

                <h3>Step 2: Open a PR to <code>main</code></h3>
                <ul>
                    <li>
                        <strong>Open PR:</strong> Base: <code>main</code> |
                        Compare: <code>release/v0.1.0</code>
                    </li>
                    <li>**CI Action:** Runs "05 - PR Quality Gate" again.</li>
                </ul>

                <h3 class="merge-note">
                    Step 3: Merge to <code>main</code> & Apply (IMPORTANT!)
                </h3>
                <ul>
                    <li>
                        When green, **Squash and merge** the PR into
                        <code>main</code>.
                    </li>
                    <li>
                        **CI Action on Push to <code>main</code>:** Runs "10 -
                        Terraform (apply on main)". Your changes are applied to
                        production.
                    </li>
                </ul>

                <h3>
                    Step 4: Back-merge <code>main</code> into
                    <code>develop</code>
                </h3>
                <p>
                    This is crucial for ensuring <code>develop</code> contains
                    the exact production history (including the final merge
                    commit).
                </p>
                <pre><code>git switch develop
git pull --rebase                # Update develop with any other changes
git merge --no-ff origin/main    # Pull main's history into develop
git push </code></pre>
            </div>

            <div class="workflow hotfix">
                <h2>3. Urgent Production Fix (Hotfix)</h2>
                <p>
                    <strong>Goal:</strong> Quick fix for a broken production
                    system. **Path:** <code>hotfix/*</code> &rarr; PR &rarr;
                    <code>main</code> &rarr; Apply &rarr; Back-merge
                </p>

                <h3>Step 1: Branch from <code>main</code></h3>
                <pre><code>git switch main
git pull --rebase               # Ensure local main is current
git switch -c hotfix/fix-bug </code></pre>

                <h3>
                    Step 2: Edit, Commit, Push & Open PR to <code>main</code>
                </h3>
                <pre><code>git add &lt;files...&gt;
git commit -m "fix: critical production issue"
git push -u origin hotfix/fix-bug </code></pre>
                <ul>
                    <li>
                        <strong>Open PR:</strong> Base: <code>main</code> |
                        Compare: <code>hotfix/fix-bug</code>
                    </li>
                    <li>**CI Action:** "05 - PR Quality Gate" runs.</li>
                </ul>

                <h3 class="merge-note">
                    Step 3: Merge to <code>main</code> & Apply (URGENT!)
                </h3>
                <ul>
                    <li>When green, merge to <code>main</code>.</li>
                    <li>
                        **CI Action on Push to <code>main</code>:** "10 -
                        Terraform (apply on main)" runs and fixes production.
                    </li>
                </ul>

                <h3>
                    Step 4: Back-merge <code>main</code> &rarr;
                    <code>develop</code>
                </h3>
                <p>
                    Integrate your fix into <code>develop</code> to prevent the
                    bug from reappearing in the next release.
                </p>
                <pre><code>git switch develop
git pull --rebase
git merge --no-ff origin/main
git push </code></pre>
            </div>

            <div class="workflow core">
                <h2>4. Conflict Resolution (Fast Mini-Guide)</h2>
                <p>
                    When Git stops with conflict markers (`<<<<<<<`, `=======`,
                    `>>>>>>>`) during a merge or rebase.
                </p>

                <h3>Conflict Resolution Commands</h3>
                <ul>
                    <li>
                        <strong
                            >Keep YOUR side entirely
                            (<code>HEAD</code>):</strong
                        >
                        <pre><code>git checkout --ours path/to/file
git add path/to/file</code></pre>
                    </li>
                    <li>
                        <strong
                            >Keep the OTHER side entirely (incoming
                            change):</strong
                        >
                        <pre><code>git checkout --theirs path/to/file
git add path/to/file</code></pre>
                    </li>
                    <li>
                        <strong>Manual Mix:</strong> Edit the file, remove all
                        markers (`<<<<<<<`, `=======`, `>>>>>>>`), keep the
                        desired lines, then <code>git add path/to/file</code>.
                    </li>
                </ul>

                <h3>Finalize the Process</h3>
                <p>After resolving and adding **all** conflicted files:</p>
                <pre><code># If you were doing a merge (git merge --no-ff)
git commit

# If you were doing a rebase (git pull --rebase)
git rebase --continue

# To abort and start over (lose current merge/rebase progress)
git merge --abort    # or git rebase --abort</code></pre>
            </div>

            <div class="workflow">
                <h2>Common Gotchas & Quick Fixes</h2>
                <ul>
                    <li>
                        <strong
                            >"cannot pull with rebase: You have unstaged
                            changes."</strong
                        >
                        <div class="explanation-box">
                            <p>
                                **The Three-Command Solution (Stash & Rebase):**
                                This safely saves, updates, and restores your
                                work.
                            </p>
                            <pre><code># 1. Save all your work, including untracked files (-u)
git stash push -u -m "wip"
# 2. Update the branch cleanly
git pull --rebase
# 3. Restore your saved work
git stash pop</code></pre>
                        </div>
                    </li>
                    <li>
                        <strong
                            >Local pre-commit hook blocks commits (e.g.,
                            pre-commit not found)</strong
                        >
                        <p>
                            Bypass once to keep moving (CI still checks
                            server-side):
                        </p>
                        <pre><code>git commit -m "msg" --no-verify</code></pre>
                    </li>
                    <li>
                        <strong>CRLF/LF warning on Windows</strong>
                        <p>
                            Harmless warning about line endings. Can be fixed
                            globally or with <code>.gitattributes</code> later.
                        </p>
                    </li>
                </ul>
            </div>
        </div>
    </body>
</html>
